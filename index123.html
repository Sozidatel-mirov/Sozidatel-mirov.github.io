<!DOCTYPE html>
<html>
<head>
<title></title>
<style type="text/css">
body				{font-size:8pt; font-family:Arial;}
.treeItem			{display:block; margin:10px 0px; padding:10px 20px; white-space:nowrap; border-bottom:solid 1px #999999; cursor:pointer;}
.treeItem_hi		{display:block; margin:10px 0px; padding:10px 20px; white-space:nowrap; border-bottom:solid 1px #999999; cursor:pointer; background-color:#ff3859;}
.treeItem_set		{display:block; margin:10px 0px; padding:10px 20px; white-space:nowrap; border-bottom:solid 1px #999999; cursor:pointer; background-color:#6d6d6d;}
</style>
<script type="text/javascript">
var itemHeightFactor = 7;
var oSource = null;
var oTarget = null;
var linecanvas_graphics;
let q_quest = []
let q_answer = []


function graphicsInit() {
	linecanvas_graphics = new Graphics('linecanvas');
}

function setSource(oSrc) {
	if (oSource != null) {
		if (oSource.className == "treeItem_hi") {
			oSource.className = "treeItem";
		}
		oSource = null;
	}

	q_quest.push(oSrc.textContent)

	if (oSrc.className == "treeItem_set") {
		clearElementSetting(oSrc.id);
	}
	oSrc.className = "treeItem_hi";
	oSource = oSrc;
	if (oTarget != null) {
		drawLine();
		oSource = null;
		oTarget = null;
	}
}
function setTarget(oTar) {
	if (oTarget != null) {
		if (oTarget.className == "treeItem_hi") {
			oTarget.className = "treeItem";
		}
		oTarget = null;
	}

	q_answer.push(oTar.textContent)

	if (oTar.className == "treeItem_set") {
		clearElementSetting(oTar.id);
	}
	oTar.className = "treeItem_hi";
	oTarget = oTar;
	if (oSource != null) {
		drawLine();
		oSource = null;
		oTarget = null;
	}
}
function clearElementSetting(stID) {
	var canvas = document.getElementById("linecanvas");
	var oChild;
	var sSourceID;
	var sTargetID;
	var arrRemoveNodes = new Array();

	for (i=0; i<canvas.childNodes.length; i++) {
		oChild = canvas.childNodes[i];
		if (oChild.tagName == "DIV") {
			if ((oChild.getAttribute("mySrc") == stID) || (oChild.getAttribute("myTar") == stID)) {
				arrRemoveNodes.push(oChild.id);
				sSourceID = oChild.getAttribute("mySrc");
				sTargetID = oChild.getAttribute("myTar");
			}
		}
	}

	for (i=0; i<arrRemoveNodes.length; i++) {
		oChild = document.getElementById(arrRemoveNodes[i]);
		canvas.removeChild(oChild);
	}

	document.getElementById(sSourceID).className = "treeItem";
	document.getElementById(sTargetID).className = "treeItem";
}

function drawLine() {
	var nSrcY = oSource.offsetTop;		
	var nTarY = oTarget.offsetTop;		
	var nRightEdge = parseInt(document.getElementById("linecanvas").style.width.replace("px", ""));
	try {
		linecanvas_graphics.drawLine(0, (nSrcY + itemHeightFactor), nRightEdge, (nTarY + itemHeightFactor));
		linecanvas_graphics.paint();
		oSource.className = "treeItem_set";
		oTarget.className = "treeItem_set";
		oSource = null;
		oTarget = null;
	} catch(e) {}
}

function checkbrowser() {
	this.b = document.body;
	this.dom = document.getElementById ? 1:0;
	this.ie = this.b && typeof this.b.insertAdjacentHTML != 'undefined';
	this.mozilla = typeof(document.createRange) != 'undefined' && typeof((document.createRange()).setStartBefore) != 'undefined';
}

function Graphics(container) {
	this.bw = new checkbrowser();
	this.color = '#000000';
	this.backbuffer = '';
	this.container = document.getElementById(container);
	this.clear = function() {this.container.innerHTML = "";this.backbuffer = '';}
	var paint_ie = function() {
		this.container.insertAdjacentHTML("BeforeEnd", this.backbuffer);
		this.backbuffer = '';
	}
	var paint_moz = function() {
		var r = document.createRange();
		r.setStartBefore(this.container);
		this.container.appendChild(r.createContextualFragment(this.backbuffer));
		this.backbuffer = '';
	}
	this.paint = this.bw.ie ? paint_ie : paint_moz;
}

Graphics.prototype.setPixel = function(x, y, w, h) {
	var myID = "Pixel_" + x + "," + y + "," + w + "," + h;
	this.backbuffer += "<div id=\"" + myID + "\" mySrc=\"" + oSource.id + "\" myTar=\"" + oTarget.id + "\" style=\"position:absolute;left:" + x + "px;top:" + y + "px;width:" + w + "px;height:" + h + "px;background-color:" + this.color + ";overflow:hidden;\"></div>";
}

Graphics.prototype.drawLine = function(x1, y1, x2, y2) {
	if (x1 > x2) {
		var tmpx = x1; var tmpy = y1;
		x1 = x2; y1 = y2;
		x2 = tmpx; y2 = tmpy;
	}
	
	var dx = x2 - x1;	
	var dy = y2 - y1; var sy = 1;	
	if (dy < 0) {
		sy = -1;
		dy = -dy;
	}
	dx = dx << 1; dy = dy << 1;
	if (dy <= dx) {	
		var fraction = dy - (dx>>1);
		var mx = x1;
		while (x1 != x2) {
			x1++;
			if (fraction >= 0) {
				this.setPixel(mx, y1,x1-mx,1);
				y1 += sy;
				mx = x1;
				fraction -= dx;
			}
			fraction += dy;
		}
		this.setPixel(mx,y1,x1-mx,1);
	} else {
		var fraction = dx - (dy>>1);
		var my = y1;
		if (sy > 0) {		
			while (y1 != y2) {
				y1++;
				if (fraction >= 0) {
					this.setPixel(x1++, my,1,y1-my);
					my = y1;
					fraction -= dy;
				}
				fraction += dx;
			}	
			this.setPixel(x1,my,1,y1-my);
		} else {
			while (y1 != y2) {
				y1--;
				if (fraction >= 0) {
					this.setPixel(x1++, y1,1,my-y1);
					my = y1;
					fraction -= dy;
				}
				fraction += dx;
			}
			this.setPixel(x1,y1,1,my-y1);		
		}
	}
}

function packageUp() {
	var oSources = document.getElementById("sourceElements");
	var oConnections = document.getElementById("linecanvas");
	var nSources = 0;
	var arrConns = new Array();
	var sLastConnSID = "";
	var bProceed = false;

	for (i=0; i<oSources.childNodes.length; i++) {
		if (oSources.childNodes[i].id) {
			if (oSources.childNodes[i].id.indexOf("Item") != -1) {
				nSources++;
			}
		}
	}
	
	for (i=0; i<oConnections.childNodes.length; i++) {
		if (oConnections.childNodes[i].getAttribute("mySrc") != sLastConnSID) {
			arrConns.push(oConnections.childNodes[i].getAttribute("mySrc"));
			arrConns.push(oConnections.childNodes[i].getAttribute("myTar"));
			sLastConnSID = oConnections.childNodes[i].getAttribute("mySrc");
		}
	}
	
	if (arrConns.length < (nSources * 2)) {
		bProceed = confirm("222");
	}
	if (bProceed) {
		
		for (i=0; i<(arrConns.length - 1); i++) {
			
			alert("Source ID " + arrConns[i] + " ID" + arrConns[i+1]);
			i++;
		}
	}
}

function finish() {
	let ff = document.querySelector(".res")
	let num = 0

	for (let index = 0; index < q_quest.length; index++) {
		const element = q_quest[index];
		
		if(element == q_answer[index]) {
			num++
		} else {
			
		}
	}

	ff.innerHTML = `Сколько правльно ${num}/3`
}
</script>
</head>
<body onLoad="graphicsInit()">

<h2 class="res"></h2>

<div id="sourceElements" style="position:absolute; left:20px; top:90px; width:300px;">
	<span id="Item0_0" class="treeItem" onclick="setSource(this)">1</span>
	<span id="Item0_1" class="treeItem" onclick="setSource(this)">2</span>
	<span id="Item0_2" class="treeItem" onclick="setSource(this)">3</span>
</div>
<div id="linecanvas" style="position:absolute;left:320px;top:90px;width:80px;"></div>
<div id="targetElements" style="position:absolute; left:400px; top:90px; width:300px;">
	<span id="Item1_0" class="treeItem" onclick="setTarget(this)">2</span>
	<span id="Item1_1" class="treeItem" onclick="setTarget(this)">1</span>
	<span id="Item1_2" class="treeItem" onclick="setTarget(this)">3</span>
</div>

<button onclick="finish()">Далее</button>

<style>
	.treeItem {
		border:solid 1px Black;
		margin: 10px 0px;
		padding: 10px 20px;
	}
</style>
</body>
</html>
